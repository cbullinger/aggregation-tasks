# Docs Copier Workflow Configuration
# Referenced from main config file in https://github.com/mongodb/code-example-tooling/blob/main/.copier/workflows/main.yaml

# ============================================================================
# LOCAL DEFAULTS
# ============================================================================
# These defaults apply to all workflows in this file
# They override main config defaults but can be overridden by individual workflows


defaults:
  commit_strategy:
    type: "pull_request"
    auto_merge: false
    use_pr_template: true
    commit_message: "Automated update from ${source_repo} PR #${pr_number} (${file_count} files)"
  deprecation_check:
    enabled: true
    file: "deprecated_examples.json"
  exclude:
    - "**/.env"
    - "**/node_modules/**"
    - "**/.DS_Store"
    - "\\.gitignore$"
    - "README.md$"

# ============================================================================
# WORKFLOW CONFIGURATION
# ============================================================================
# To add a workflow, create a DOCSP Jira ticket with the component set to `DevDocs`.
# See also [README.md](https://github.com/mongodb/docs-sample-apps/blob/main/.copier/README.md)

workflows:

  # --------------------------------------------------------------------------
  # MFlix Java Application
  # --------------------------------------------------------------------------
  - name: "mflix-java"
    destination:
      repo: "mongodb/sample-app-java-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/java-spring", to: "server" }
      - copy: { from: "mflix/README-JAVA-SPRING.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-java", to: ".gitignore" }
    commit_strategy:
      pr_title: "Update MFlix application from docs-sample-apps"
      pr_body: |
        Automated update of MFlix Java application

        **Source:** ${source_repo} (${source_branch})
        **PR:** #${pr_number} | **Commit:** ${commit_sha}
        **Changes:** ${file_count} files 
    exclude:
      - "mflix/client/**/.gitignore"
      - "mflix/server/java-spring/**/.gitignore"


  # --------------------------------------------------------------------------
  # MFlix Node.js Application
  # --------------------------------------------------------------------------
  - name: "mflix-nodejs"
    destination:
      repo: "mongodb/sample-app-nodejs-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/js-express", to: "server" }
      - copy: { from: "mflix/README-JAVASCRIPT-EXPRESS.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-js", to: ".gitignore" }
    commit_strategy:
      pr_title: "Update MFlix application from docs-sample-apps"
      pr_body: |
        Automated update of MFlix Node.js application

        **Source:** ${source_repo} (${source_branch})
        **PR:** #${pr_number} | **Commit:** ${commit_sha}
        **Changes:** ${file_count} files 
    exclude:
      - "mflix/client/**/.gitignore"
      - "mflix/server/js-express/**/.gitignore"


  # --------------------------------------------------------------------------
  # MFlix Python Application
  # --------------------------------------------------------------------------
  - name: "mflix-python"
    destination:
      repo: "mongodb/sample-app-python-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/python-fastapi", to: "server" }
      - copy: { from: "mflix/README-PYTHON-FASTAPI.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-python", to: ".gitignore" }
    commit_strategy:
      type: "pull_request"
      pr_title: "Update MFlix application from docs-sample-apps"
      pr_body: |
        Automated update of MFlix Python application

        **Source:** ${source_repo} (${source_branch})
        **PR:** #${pr_number} | **Commit:** ${commit_sha}
        **Changes:** ${file_count} files 
      auto_merge: false
    exclude:
      - "mflix/client/**/.gitignore"
      - "mflix/server/python-fastapi/**/.gitignore"
