# Workflow Configuration File
# Referenced from main config file in https://github.com/mongodb/code-example-tooling/blob/main/.copier/workflows/main.yaml
# For information more on workflow configs, see https://github.com/mongodb/code-example-tooling/tree/main/examples-copier/configs/copier-config-examples

# ============================================================================
# LOCAL DEFAULTS
# ============================================================================
# These defaults apply to all workflows in this file
# They override main config defaults but can be overridden by individual workflows

defaults:
  commit_strategy:
    type: "pull_request"
    auto_merge: false
  deprecation_check:
    enabled: true
    file: "deprecated_examples.json"
  exclude:
    - "**/.env"
    - "**/.env.*"
    - "**/node_modules/**"
    - "**/.DS_Store"
    - "\\.gitignore$"
    - "README.md$"

# ============================================================================
# WORKFLOWS
# ============================================================================
# Each workflow defines a complete source â†’ destination mapping

workflows:
  # --------------------------------------------------------------------------
  # MFlix Java Application
  # --------------------------------------------------------------------------
  - name: "mflix-java"
    destination:
      repo: "mongodb/sample-app-java-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/java-spring", to: "server" }
      - copy: { from: "mflix/README-JAVA-SPRING.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-java", to: ".gitignore" }
    commit_strategy:
      $ref: "../strategies/mflix-pr-strategy.yaml"

  # --------------------------------------------------------------------------
  # MFlix Node.js Application
  # --------------------------------------------------------------------------
  - name: "mflix-nodejs"
    destination:
      repo: "mongodb/sample-app-nodejs-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/js-express", to: "server" }
      - copy: { from: "mflix/README-JAVASCRIPT-EXPRESS.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-js", to: ".gitignore" }
    commit_strategy:
      $ref: "../strategies/mflix-pr-strategy.yaml"

  # --------------------------------------------------------------------------
  # MFlix Python Application
  # --------------------------------------------------------------------------
  - name: "mflix-python"
    destination:
      repo: "mongodb/sample-app-python-mflix"
      branch: "main"
    transformations:
      - move: { from: "mflix/client", to: "client" }
      - move: { from: "mflix/server/python-fastapi", to: "server" }
      - copy: { from: "mflix/README-PYTHON-FASTAPI.md", to: "README.md" }
      - copy: { from: "mflix/.gitignore-python", to: ".gitignore" }
    commit_strategy:
      $ref: "../strategies/mflix-pr-strategy.yaml"


# ============================================================================
# ADDING A NEW WORKFLOW
# ============================================================================
#
# To add a new workflow to this source repo:
#
# 1. Add a new workflow entry to this file
# 2. Define destination and transformations
# 3. Optionally override commit strategy
# 4. Commit and push to source repo
# 5. No changes needed to main config!
#
# Example (with source context inference):
#
# - name: "new-app-java"
#   # source.repo and source.branch inherited automatically
#   destination:
#     repo: "mongodb/sample-app-java-newapp"
#     branch: "main"
#   transformations:
#     - move: { from: "newapp/client", to: "client" }
#     - move: { from: "newapp/server/java", to: "server" }
#
# ============================================================================
# TESTING WORKFLOW CONFIGS
# ============================================================================
#
# You can test workflow configs locally before deploying:
#
# 1. Create a test config file
# 2. Use DRY_RUN=true to test without making changes
# 3. Validate transformations work as expected
# 4. Check PR titles and bodies
#
# ============================================================================

